---
title : "[ElasticSearch] 매핑과 필드타입"
tags :
 - ElasticSearch
---

# 매핑과 필드타입

매핑은 문서가 인덱스에 어떻게 색인되고 저장되는지 정의하는 부분이다.

<br/>

### 동적 매핑 vs 명시적 매핑

자동으로 생성하는 매핑을 `동적 매핑`이라고 부르고 반대로 사용자가 직접 매핑을 지정해주는 방법은 `명시적 매핑`이라고 부른다. 중요한 것은 필드 타입을 포함한 매핑 설정 내 대부분의 내용은 한번 지정되면 사실상 변경이 불가능하다는 점이다. 따라서 서비스와 데이터 설계를 할때 신중해야 한다. 서비스 운영환경에서는 위와 같은 이유로 명시적 매핑을 사용하여 인덱스를 운영한다. 이미 인덱스가 생성된 경우에도 신규 필드를 추가할 때에는 매핑 정보를 추가할 수 있다.

```http
PUT my_index/_mapping
{
	"properties": {
		"longValue": {
			"type": "long"
		}
	}
}
```

매핑 정보 확인

```http
GET my_index/_mapping
{}
```

<br/>

### 필드 타입

매핑의 기본은 필드 타입이다. 필드 타입은 필드의 값이 어떤 형태로 저장될지를 지정한다. 매핑의 필드 타입은 한 번 지정되면 변경이 불가능하다.

| 분류                      | 종류                                              |
| ------------------------- | ------------------------------------------------- |
| 심플 타입                 | text, keyword, date, long, double, boolean, ip 등 |
| 계층 구조를 지원하는 타입 | object, nested  등                                |
| 그 외 특수한 타입         | geo_point, geo_shape 등                           |

#### 심플 타입

심플 타입은 주로 직관적으로 알기 쉬운 간단한 자료형이다.

<br/>

##### 숫자 타입

| 종류         | 설명                                                         |
| ------------ | ------------------------------------------------------------ |
| long         | 64비트 부호 있는 정수                                        |
| integer      | 32비트 부호 있는 정수                                        |
| short        | 16비트 부호 있는 정수                                        |
| byte         | 8비트 부호 있는 정수                                         |
| double       | 64비트 부동소수점 수                                         |
| float        | 32비트 부동소수점 수                                         |
| half_float   | 16비트 부동소수점 수                                         |
| scaled_float | double 고정 환산 계수로 스케일링 하여 long으로 저장되는 부동소수점 수 |

정수형 데이터를 담는 필드라면 비즈니스 요건에 맞는 범위에서 가장 작은 비트를 사용하는 자료형을 고르면 된다. 작은 비트를 사용하는 자료형을 고르면 색인과 검색 시 이득이 있다. 다만 저장할 때는 실제 값에 맞춰 최적화되기 때문에 디스크 사용량에는 이득이 없다.

부동소수점 수를 담는 필드라면 환산 계수로 스케일링해서 정수로 저장하는 scaled_float 타입을 고려할 수 있다. scaling_factor라는 환산 계수 인자를 지정해야 하는데 이 값이 100이고 실제 값이 3.943이면 이를 394라는 정수로 색인한다. 이후의 검색, 집계, 정렬 과정에서는 이 필드가 3.94 값을 가진 것 처럼 동작한다. 부동소수점 수보다는 정수의 형태로 저장하는 것이 압축이 쉬워 디스크 공간에서 이득을 볼 수 있다. 정확도에서 손해를 보는 만큼 디스크를 절약한다고 볼 수 있다.

<br/>

##### date 타입

date 타입은 시간과 관련된 데이터를 편리하게 색인하고 검색하기 위해 도입된 타입이다. 해당 필드를 문자열 형식 및 epoch milliseconds 형식의 검색도 잘 된다는 사실을 알 수 있다. date 타입은 인입되는 데이터의 형식을 format이라는 옵션으로 지정할 수 있으며 문서가 어떤 형식으로 들어오더라도 엘라스틱서치 내부적으로는 UTC 시간대로 변환하는 과정을 거쳐 epoch milliseconds 형식의 long 숫자로 색인된다. format에는 java.time.format.DateTimeFormatter로 인식 가능한 패턴을 사용할 수 있다. format의 기본값은 strict_date_optional_time || epoch_millis다.

| 종류                      | 설명                                                         |
| ------------------------- | ------------------------------------------------------------ |
| epoch_millis              | 밀리초 단위로 표현한 epoch 시간                              |
| epoch_second              | 초 단위로 표현한 epoch 시간                                  |
| date_time                 | yyyyMMdd 형태로 표현한 날짜                                  |
| strict_date_time          | yyy-MM-dd'T'HH:mm:ss.SSSZZ로 표현한 날짜와 시간              |
| date_optional_time        | 최소 연 단위의 날짜를 포함해야 하며, 선택적으로 시간 정보도 포함하여 IOS datetime 형태로 표현된 날짜와 시간 |
| strict_date_optional_time | date_optional_time과 동일하지만 연, 월, 일이 각각 4자리,2 자리, 2자리임을 보장해야 한다. |

<br/>

##### 배열

엘라스틱서치에는 배열을 표현하는 별도의 타입 구분이 없다. long 타입의 필드에는 309라는 단일 숫자 데이터를 넣을 수도 있고 [221,309,150505] 배열 데이터도 넣을 수 있다.

색인한 문서들을 검색도 할 수 있다. 엘라스틱서치는 색인 과정에서 데이터가 단일 데이터인지 배열 데이터인지에 상관없이 각 값마다 하나의 독립적인 역색인을 구성하기 때문이다.

<br/>

#### 계층 구조를 지원하는 타입
